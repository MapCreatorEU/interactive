<!DOCTYPE html>
<html>
<head>
	<title>S&D Charlotte Map - Maps4News</title>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="shortcut icon" type="image/x-icon" href="docs/images/favicon.ico" />
	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css" />
	<link rel="stylesheet" href="maps4news.css" />

	<script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet.js"></script>
	<script src="https://unpkg.com/leaflet.markercluster@1.0.4/dist/leaflet.markercluster.js"></script>

	<style>
		#mapContainer {
			height: 500px;
		}
		body {
			padding: 0;
			margin: 0;
		}
	</style>
</head>
<body>
<div id='mapContainer'></div>
<script src="charlotte.js" type="text/javascript"></script>
<script>
	var map = L.map('mapContainer', {}).setView([ 35.215233, -80.838953 ], 12);
	var southWest = new L.LatLng(34.9021, -81.2636); 
	var northEast = new L.LatLng(35.514, -80.3947); 
	var restrictBounds = new L.LatLngBounds(southWest, northEast); 
	var tL = L.tileLayer('https://d3vdg4r0bnfb5l.cloudfront.net/tiles/{z}_{x}_{y}.png', {
	    attribution: '<a target="_blank" href="https://maps4news.com">Maps4News &copy;</a>',
	    maxNativeZoom: 15,
	    minZoom: 12,
	}).addTo(map);
	var markers = L.markerClusterGroup({
		showCoverageOnHover: false,
		maxClusterRadius: 50,
		iconCreateFunction: function (cluster) {
			var childCount = cluster.getChildCount();
			var c = ' marker-cluster-';
			var s = 0;
			if (childCount < 10) {
				c += 'small';
				s = 30;
			} else if (childCount < 15) {
				c += 'medium';
				s = 35;
			} else {
				c += 'large';
				s = 40;
			}
			return new L.DivIcon({ html: '<div><span>' + childCount + '</span></div>', className: 'marker-cluster' + c, iconSize: new L.Point(s,s) });
		},
	});

	var gJ = L.geoJSON([charlotte], {
		style: function (feature) {
			return feature.properties && feature.properties.style;
		},
		onEachFeature: function(feature, layer) {
			var popupContent = "<p>" +feature.properties['NAME'] + "</p>";
			popupContent += "<p>" +feature.properties['DESCRIPTION'] + "</p>";
			layer.bindPopup(popupContent);
		},
		pointToLayer: function (feature, latlng) {
			var svgString = feature.properties.SVG;
			var svgURL = "data:image/svg+xml;base64," + btoa(svgString);
			var pinIcon = L.icon({
        		iconUrl: svgURL,
        		iconSize: [40, 60],
        		iconAnchor: [20, 30],
        	});     
		    return L.marker(latlng, {
		    	icon: pinIcon
		    });
		}
	}).addTo(markers);
	markers.addTo(map);

	map.setMaxBounds ( restrictBounds );
	map.on('mousedown', function(e) {
		if( !touchInfo.isEnabled() ) {
			touchInfo.enable();
		}
	});
	map.on('contextmenu', function(e) {
		if( touchInfo.isEnabled() ) {
			touchInfo.disable();
		}
	});
	map.zoomControl.setPosition('bottomright');
	map.attributionControl.setPosition('topright');

	var touchInfo = L.control({position: 'bottomleft'});
	touchInfo.onAdd = function (map) {
		this._div = L.DomUtil.create('div', 'touch-info');
	    return this._div;
	};
	touchInfo.enable = function() {
		var action = L.Browser.mobile ? 'Hold' : 'Right click';
		this._touchActive = true;
		this._div.innerHTML = '<i class="touch-info-icon enabled"></i>'+action+' to deactivate';

		map.touchZoom.enable();
		map.scrollWheelZoom.enable();
		map.dragging.enable();
		if(map.tap) { map.tap.enable() };
		return this;
	}
	touchInfo.disable = function() {
		var action = L.Browser.mobile ? 'Tap' : 'Click';
		this._touchActive = false;
		this._div.innerHTML = '<i class="touch-info-icon disabled"></i>'+action+' to activate';
		
		map.touchZoom.disable();
		map.scrollWheelZoom.disable();
		map.dragging.disable();
		map.scrollZoom.disable();
		if(map.tap) { map.tap.disable() };
		return this;
	}
	touchInfo.isEnabled = function() {
		return this._touchActive;
	}
	touchInfo.addTo(map).disable();
</script>
</body>
</html>
